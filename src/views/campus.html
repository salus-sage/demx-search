<!-- Bootstrap core CSS -->
    <link href="assets/css/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!-- Custom styles for this template -->
    <link href="assets/css/theme2.css" rel="stylesheet">
    <!-- Heading Font -->
    <!--link href="https://fonts.googleapis.com/css?family=Passion+One:700" rel="stylesheet"-->
    <!--link href="https://fonts.googleapis.com/css?family=Alfa+Slab+One" rel="stylesheet" --> 
    <link href="assets/css/lib/animate.css" rel="stylesheet"> 
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <link href="assets/js/lib/lightgallery/css/lightgallery.min.css" rel="stylesheet">
    <link href="assets/js/lib/swiper/swiper.min.css" rel="stylesheet">
    <!--link href="assets/css/lib/plyr.min.css" rel="stylesheet"-->
   
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  
    <!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Roboto+Slab:400,700" rel="stylesheet">

    <link rel="stylesheet" href="assets/js/lib/swiper/swiper.min.css">

    <link rel="stylesheet" href="assets/css/lib/plyr.min.css">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="assets/css/lib/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Vendor Scripts -->
    <script type="text/javascript" src="assets/js/lib/jQuery.min.js"></script>

    <script src="assets/css/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/vuejs-paginate@latest"></script>
    <script type="text/javascript" src="assets/js/lib/plyr.min.js"></script>
    <script type="text/javascript" src="assets/js/lib/lightgallery/js/lightgallery-all.min.js"></script>

<section id="search-app">
    <!-- HEADER -->
        <section class="sticky-header">
          <header>
            <div class="banner-text ">
              <a href="#/home" class="hidden-xs"/>
                <h1>CAMPUS UPRISINGS</h1>
                <p class="sub-heading">Student Movements in India</p>
              </a>
              <div class="nav-wrap">
             
                    <nav class="navbar navbar-style">
                      <div class="container">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <div class="navbar-header">
                          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mainmenu-collapse-target" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                          </button>
                          <a class="navbar-brand hidden-sm hidden-md hidden-lg" href="https://campusuprisings.demx.in">
                            <h4 class="brand-mobile">CAMPUS UPRISINGS</h4>
                            <span>Student Movements in India</span>
                          </a>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                  <div class="collapse navbar-collapse" id="mainmenu-collapse-target">
                    <ul class="nav navbar-nav navbar-center">
                      <li role="presentation" class=""><a href="https://campusuprisings.demx.in/#/items/videos?univ=all">FOOTAGE</a>
                      </li>
                      <li role="presentation" class=""><a href="https://campusuprisings.demx.in/#/items/images?univ=all">IMAGES</a>
                      </li>
                      <!--li role="presentation" class=""><a href="/#about">ABOUT</a></li-->
                      <li role="presentation" class=""><a href="https://campusuprisings.demx.in/#/items/audio?univ=all">INTERVIEWS</a></li>
                      <li role="presentation" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">DOSSIER <span class="caret"></span></a>
                        <ul class="dropdown-menu animated fadeIn delay-2s">
                          <li><a href="https://campusuprisings.demx.in/#/items/docs?univ=all">DOCUMENTS</a></li>
                          <li role="separator" class="divider"></li>
                            <li><a href="https://campusuprisings.demx.in/#/items/posters?univ=all">POSTERS</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="https://campusuprisings.demx.in/#/items/pamphlets?univ=all">PAMPHLETS</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="https://campusuprisings.demx.in/#/items/cartoons?univ=all">CARTOONS</a></li>
     
                            
                        </ul>
                      </li>
                      
                                                                        
                      <li role="presentation"><a href="https://campusuprisings.demx.in#/credits">CREDITS</a></li>
                    </ul>

                    <div class="search-form-input" style="padding:0px;">
                        <form action="" class="search-form">
                            <div class="form-group has-feedback">
                                <label for="search" class="sr-only">Search</label>
                                <input type="text" class="form-control" name="search" id="search" placeholder="search" v-model="query" >
                                <span class="glyphicon glyphicon-search form-control-feedback"></span>
                            </div>
                        </form>
                    </div>
                  </div>
                </div>
              </nav>
            </div>
        </div>
      </header>
    </section>
    <div class="container">
        <div class="row">
            <div class="col-md-3" style="padding:0px;">
                <h2>Search Results</h2>
            </div>
        </div>
        <div class="row">

        </div>
        <div class="row">
            <p>Found {{ total }} items in {{  took }} milliseconds. </p>
        <div id="items-grid-wrap">
            <div class="item-bindings"  v-for="result in results">
                <!-- If item is image -->
                   <div class="item image"
                        v-if="result._source.fileExt === 'jpg' || result._source.fileExt === 'JPG'"
                        v-bind:data-id = "result._source.id"  
                        v-bind:data-sub-html = "result._source.metaHTML | sanitizeHTML" 
                        v-bind:title="result._source.title" 
                        v-bind:data-src="result._source.fileUrl">
                       <img class="img-responsive image-item"   
                            v-bind:src="result._source.thumbnail" />
                       
                       <div class="item-caption">
                       <a v-bind:href="result._source.fileUrl" >
                         <h3 class="item-title" >
                           {{ result._source.title | sanitizeHTML }}
                         </h3>
                         </a>
                         <small> 
                         Date: {{ result._source.sortField }}
                         </small>
                   </div>
               </div> 
               <div class="item link"
                    v-else-if="result._source.fileExt === 'pdf' || result._source.fileExt === 'docx'"
                    v-bind:data-id = "result._source.id"  
                    v-bind:data-sub-html = "result._source.metaHTML | sanitizeHTML" 
                    v-bind:title="result._source.title" 
                    v-bind:data-src="result._source.thumbnail">
                   <img class="img-responsive image-item"   
                        v-bind:src="result._source.thumbnail" />
                   
                   <div class="item-caption">
                   <a v-bind:href="result._source.fileUrl" >
                     <h3 class="item-title" >
                       {{ result._source.title | sanitizeHTML }}
                     </h3>
                     </a>
                     <small> 
                     Date: {{ result._source.sortField }}
                     </small>
               </div>
           </div>
           <div class="item video" 
                v-else-if="result._source.fileExt === 'mp4' || result._source.fileExt === 'MP4'"
                    >
            <div style="display:none;" v-bind:id="result._source.id">
                <video class="lg-video-object lg-html5" v-bind:poster="result._source.thumbnail" controls preload="none">
                    <source v-bind:src="result._source.fileUrl" type="video/mp4">
                     Your browser does not support HTML5 video.
                </video>
            </div>

            <div v-bind:data-html="result._source.id" v-bind:data-id="result._source.id" v-bind:data-type="result._source.type"  v-bind:data-sub-html = "result._source.metaHTML | sanitizeHTML"  >
            
                 <img v-bind:src="result._source.thumbnail" class="video-icon" />
                <div class="item-caption" style="max-height:100%;">
                <a v-bind:href="result._source.fileUrl" >
                  <h3 class="item-title">
                    {{ result._source.title }}
                  </h3>
                  </a>
                  
                 
                  <small> 
                  Date: {{ result._source.sortField }}
                  </small>
                  
                </div>

            </div>
           </div>
           <div v-else>
            {{ result._source.fileExt }}
           </div> 
            
            </div>
            </div>
            <paginate
                v-model="page"
                :page-count="pageCount"
                 container-class="pagination"
                 prev-text="prev"
                 next-text="next"
                :click-handler="paginateClick">
              </paginate>
        </div>
    </div>

</section>

<!--- some styling for the page -->
<style>
    .search-form .form-group {
        float: right !important;
        transition: all 0.35s, border-radius 0s;
        width: 32px;
        height: 32px;
        background-color: transparent;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.075) inset;
        border-radius: 25px;
        border: 1px solid #223c44;
    }

    .search-form .form-group input.form-control {
        padding-right: 20px;
        border: 0 none;
        background: transparent;
        box-shadow: none;
        display: block;
    }

    .search-form .form-group input.form-control::-webkit-input-placeholder {
        display: none;
    }

    .search-form .form-group input.form-control:-moz-placeholder {
        /* Firefox 18- */
        display: none;
    }

    .search-form .form-group input.form-control::-moz-placeholder {
        /* Firefox 19+ */
        display: none;
    }

    .search-form .form-group input.form-control:-ms-input-placeholder {
        display: none;
    }

    .search-form .form-group:hover,
    .search-form .form-group:active,
    .search-form .form-group.hover {
        width: 100%;
        border-radius: 4px 25px 25px 4px;
    }

    .search-form .form-group span.form-control-feedback {
        position: absolute;
        top: -1px;
        right: -2px;
        z-index: 2;
        display: block;
        width: 34px;
        height: 34px;
        line-height: 34px;
        text-align: center;
        color: #223c44;
        left: initial;
        font-size: 14px;
    }
    .results-wrap {
        display: grid;
        grid-gap: 5px;
        grid-template-columns: repeat(auto-fill, minmax(160px,1fr));
        margin-bottom: 25px;
    }
    .pagination {
      display: flex;
      justify-content: center;
    }
</style>

<script type="text/javascript">
    Vue.component('paginate', VuejsPaginate)
    // create a new Vue instance
    var app = new Vue({
        el: '#search-app',
        // declare the data for the component (An array that houses the results and a query that holds the current search string)
        data: {
            results: [],
            total: 0,
            took: 0,
            query: '',
            pageCount: 0,
            page: 1
        },
        filters: {
            // function escape html chars
            sanitizeHTML: function(s) {
                if(!s) return ''
                return s ? s.replace(/\\/g,'') : s;
                function hex(c) { 
                    var v = '0'+c.charCodeAt(0).toString(16); 
                    return '\\x'+v.substr(v.length-2); 
                }
            }
        },
        // declare methods in this Vue component. here only one method which performs the search is defined
        methods: {
            // make an axios request to the server with the current search query
            search: function() {
                axios.get("/search?q=" + this.query + "&" + "page=" + this.page)
                    .then(response => {
                        this.total = response.data.hits.total.value;
                        this.took = response.data.took
                        this.results = response.data.hits.hits;
                        this.pageCount = parseInt(response.data.hits.total.value / 20);
                        //console.log(response, this.results);
                    })
                    .finally(() => {
                      $("#items-grid-wrap").lightGallery({
                          selector: '.item',
                          hash: false,
                          share: false,
                          zoom: true,
                          download: false,
                          autoplayControls: false,
                          appendSubHtmlTo: '.lg-item',
                          enableDrag: true,
                          enableTouch: true,
                          preload: 2
                        }) 
                    })
            },
            paginateClick: function(e) {
              console.log("clicked", e)
              this.page = parseInt(e)
              let newUrl = window.location.toString().split('&')[0] + "&page=" + this.page;
              window.history.pushState({}, null, newUrl)
            }
        },
        // declare Vue watchers
        watch: {
            // watch for change in the query string and recall the search method
            query: function() {
                this.search()
            },
            page: function() {
              this.search()
            }
        },

        mounted() {
          // initial state from url query params
            if(window.location.toString().indexOf("?") > 0){
                this.query = window.location.toString().split('?')[1].split('=')[1].split('&')[0] || '';
                this.page = parseInt(window.location.toString().split('?')[1].split('=')[2]) || 1;
            }


            
        }

    })

</script>